{% extends "base.html" %}

{% block title %}Commander - Application mobile Essentielle | Inspire Code{% endblock %}

{% block content %}

<section class="ic-hero-offre d-flex align-items-center text-white text-center">
  <div class="container py-4">
    <h1 class="display-6 fw-bold mb-2">Commander : Application mobile Essentielle</h1>
    <p class="lead mt-2 mb-0">
      Base à partir de <strong>490 €</strong>. Ajoutez uniquement les options utiles à votre usage.
    </p>
  </div>
</section>

<section class="py-5">
  <div class="container">

    <div class="row g-4">
      <!-- CONFIG OPTIONS -->
      <div class="col-lg-7">
        <div class="card shadow-sm">
          <div class="card-body p-4">

            <h2 class="h4 fw-bold mb-3">1) Configurez votre application</h2>
            <p class="text-muted mb-4">
              Ce parcours est conçu pour les prospects autonomes : vous sélectionnez vos options, vous voyez le prix final, puis vous validez.
            </p>

            <!-- Base -->
            <div class="d-flex align-items-start justify-content-between border rounded p-3 mb-3">
              <div>
                <div class="fw-semibold">Pack Essentielle</div>
                <div class="small text-muted">
                  Web app mobile simple, pensée pour un usage précis (mobile-first).
                </div>
              </div>
              <div class="fw-bold">490 €</div>
            </div>

            <!-- Options -->
            <h3 class="h5 fw-bold mt-4 mb-3">Options</h3>

            <!-- Desktop (outil) -->
            <div class="form-check border rounded p-3 mb-3">
              <input class="form-check-input js-option" type="checkbox" value="400" id="opt-desktop">
              <label class="form-check-label w-100" for="opt-desktop">
                <div class="d-flex justify-content-between">
                  <div>
                    <div class="fw-semibold">Adaptation pour usage desktop (outil)</div>
                    <div class="small text-muted">
                      Permet d’utiliser l’application sur ordinateur avec une interface adaptée à l’écran.
                      <strong>Ce n’est pas un site vitrine</strong> : pas de pages publiques, pas de SEO, pas de contenu “présence web”.
                    </div>
                  </div>
                  <div class="fw-bold">+400 €</div>
                </div>
              </label>
            </div>

            <!-- Google Play -->
            <div class="form-check border rounded p-3 mb-3">
              <input class="form-check-input js-option" type="checkbox" value="250" id="opt-google">
              <label class="form-check-label w-100" for="opt-google">
                <div class="d-flex justify-content-between">
                  <div>
                    <div class="fw-semibold">Publication sur Google Play</div>
                    <div class="small text-muted">
                      Préparation des éléments et accompagnement à la publication.
                      <strong>Frais Google non inclus</strong> (compte développeur requis).
                    </div>
                  </div>
                  <div class="fw-bold">+250 €</div>
                </div>
              </label>
            </div>

            <!-- Apple App Store -->
            <div class="form-check border rounded p-3 mb-3">
              <input class="form-check-input js-option" type="checkbox" value="350" id="opt-apple">
              <label class="form-check-label w-100" for="opt-apple">
                <div class="d-flex justify-content-between">
                  <div>
                    <div class="fw-semibold">Publication sur l’Apple App Store</div>
                    <div class="small text-muted">
                      Préparation des éléments et accompagnement à la publication.
                      <strong>Frais Apple non inclus</strong> (abonnement développeur annuel requis).
                    </div>
                  </div>
                  <div class="fw-bold">+350 €</div>
                </div>
              </label>
            </div>

            <!-- Two stores -->
            <div class="form-check border rounded p-3 mb-3">
              <input class="form-check-input js-option" type="checkbox" value="500" id="opt-stores">
              <label class="form-check-label w-100" for="opt-stores">
                <div class="d-flex justify-content-between">
                  <div>
                    <div class="fw-semibold">Publication sur deux stores (Google + Apple)</div>
                    <div class="small text-muted">
                      Préparation complète pour iOS et Android.
                      <strong>Frais Apple/Google non inclus</strong> (comptes développeur requis).
                    </div>
                  </div>
                  <div class="fw-bold">+500 €</div>
                </div>
              </label>
            </div>

            <!-- Notes -->
            <div class="alert alert-light border mt-4 mb-0">
              <div class="fw-semibold mb-1">Bon à savoir</div>
              <div class="small text-muted">
                Après paiement, je vous contacte pour confirmer l’usage principal, récupérer les contenus nécessaires (logo, textes, éléments) et valider les options choisies.
                <br>
                Cette offre couvre exclusivement les éléments décrits ci-dessus. Toute extension du périmètre initial pourra entraîner un ajustement tarifaire.
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- PANIER / RECAP -->
      <div class="col-lg-5">
        <div class="card shadow-sm position-sticky" style="top: 110px;">
          <div class="card-body p-4">

            <h2 class="h4 fw-bold mb-3">2) Récapitulatif</h2>

            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Base Essentielle</span>
              <span class="fw-semibold">490 €</span>
            </div>

            <div id="recapOptions" class="mb-3"></div>

            <hr class="my-3">

            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="fw-bold">Total</span>
              <span class="fw-bold fs-4"><span id="totalPrice">490</span> €</span>
            </div>

            <div class="small text-muted mb-4">
              Paiement sécurisé via Stripe. Vous recevrez une confirmation par email.
            </div>

            <!-- CTA paiement (placeholder pour l’instant) -->
            <a id="payBtn"
               href="{{ url_for('devis') }}"
               class="btn btn-primary btn-lg w-100 fw-semibold">
              Payer <span id="payBtnPrice">490</span> €
            </a>

            <a href="{{ url_for('contact') }}" class="btn btn-outline-secondary w-100 mt-3">
              J’ai une question avant de payer
            </a>

            <div class="small text-muted mt-4">
              <strong>Astuce :</strong> si vous hésitez sur le périmètre, les priorités ou la suite (stores, évolutions),
              l’Atelier Mobile est l’option la plus confortable.
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<script>
  (function () {
    const BASE_PRICE = 490;

    const optionInputs = Array.from(document.querySelectorAll(".js-option"));
    const recapOptions = document.getElementById("recapOptions");
    const totalPriceEl = document.getElementById("totalPrice");
    const payBtnPriceEl = document.getElementById("payBtnPrice");

    function formatEUR(value) {
      return `${value} €`;
    }

    function updateRecap() {
      let total = BASE_PRICE;

      // Reset recap
      recapOptions.innerHTML = "";

      const selected = optionInputs.filter(i => i.checked);

      if (selected.length === 0) {
        const empty = document.createElement("div");
        empty.className = "text-muted small";
        empty.textContent = "Aucune option sélectionnée.";
        recapOptions.appendChild(empty);
      } else {
        selected.forEach(input => {
          const price = parseInt(input.value, 10) || 0;
          total += price;

          const label = document.querySelector(`label[for="${input.id}"]`);
          const titleEl = label ? label.querySelector(".fw-semibold") : null;
          const title = titleEl ? titleEl.textContent.trim() : "Option";

          const row = document.createElement("div");
          row.className = "d-flex justify-content-between mb-2";
          row.innerHTML = `
            <span class="text-muted">${title}</span>
            <span class="fw-semibold">+${formatEUR(price)}</span>
          `;
          recapOptions.appendChild(row);
        });
      }

      totalPriceEl.textContent = total;
      payBtnPriceEl.textContent = total;
    }

    optionInputs.forEach(i => i.addEventListener("change", updateRecap));
    updateRecap();
  })();
</script>

{% endblock %}
